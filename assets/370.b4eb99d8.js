(()=>{"use strict";var t={540:function(t,e,i){var r=i("412"),s=i("912"),a=i("541"),n=JSON.parse('{"s":"kaeru-shigure/wd-swinv2-tagger-v3-opt"}');let o=new class t{async convert(t){let e=await createImageBitmap(t);this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);let i=Math.min(this.canvas.width/e.width,this.canvas.height/e.height),r=this.canvas.width/2-e.width/2*i,s=this.canvas.height/2-e.height/2*i;this.ctx.drawImage(e,r,s,e.width*i,e.height*i);let a=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height).data,n=new Float32Array(a.length/4*3);for(let t=0,e=0;t<a.length;t+=4,e+=3)n[e]=a[t+2],n[e+1]=a[t+1],n[e+2]=a[t];return n}constructor(){(0,r._)(this,"canvas",void 0),(0,r._)(this,"ctx",void 0),this.canvas=new OffscreenCanvas(448,448),this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="white",this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",this.convert=this.convert.bind(this)}}().convert;async function u(t,e,i,r){let s=(0,a.P)(100,r,{noTrailing:!0}),n=await fetch(t);if(!n.ok)throw Error("Network response was not ok");n.headers.get("Content-Length");let o=i.reduce((t,e)=>t+e,0);if(!n.body)throw Error("No body");let u=n.body.getReader(),h=i.slice(0,e).reduce((t,e)=>t+e,0),c=[];for(;;){let{done:t,value:e}=await u.read();if(t)break;c.push(e),h+=e.length,o&&s(h/o)}let f=new Uint8Array(h),l=0;for(let t of c)f.set(t,l),l+=t.length;return f.buffer}async function h(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>{},e=[`https://huggingface.co/${n.s}/resolve/main/model.onnx`,`https://huggingface.co/${n.s}/resolve/main/model_ext.bin`],i=[650218,0x1b8838b4],r=await caches.open("kaeru-ic-v1"),s=async(e,s)=>{let a=await r.match(e);if(a&&a.ok)return await a.arrayBuffer();let n=await u(e,s,i,t);return r.put(e,new Response(n)),n},a=[];for(let t=0;t<e.length;t++)a.push(await s(e[t],t));return a}let c=null,f=async t=>await c.run(await o(t)),l=Promise.resolve();class p{async init(t,e){return s.OB.webgpu.powerPreference="high-performance",this.ortSession=await s.Bc.create(t,{executionProviders:["webgpu"],enableGraphCapture:!1,externalData:[{path:"model_ext.bin",data:e}]}),this.device=s.OB.webgpu.device,this.inputBuffer=this.device.createBuffer({usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,size:2408448}),this.outputBuffer=this.device.createBuffer({usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC,size:43444}),this.stagingBuffer=this.device.createBuffer({usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST,size:43444}),this.inputTensor=s.es.fromGpuBuffer(this.inputBuffer,{dataType:"float32",dims:[1,448,448,3]}),this.outputTensor=s.es.fromGpuBuffer(this.outputBuffer,{dataType:"float32",dims:[1,10861]}),this}async run(t){this.device.queue.writeBuffer(this.inputBuffer,0,t),await this.ortSession.run({[this.ortSession.inputNames[0]]:this.inputTensor},{[this.ortSession.outputNames[0]]:this.outputTensor});let e=this.device.createCommandEncoder();e.copyBufferToBuffer(this.outputBuffer,0,this.stagingBuffer,0,43444),this.device.queue.submit([e.finish()]),await this.stagingBuffer.mapAsync(GPUMapMode.READ,0,43444);let i=this.stagingBuffer.getMappedRange(0,43444),r=new Float32Array(10861);return r.set(new Float32Array(i)),this.stagingBuffer.unmap(),r}constructor(){(0,r._)(this,"ortSession",void 0),(0,r._)(this,"inputBuffer",void 0),(0,r._)(this,"outputBuffer",void 0),(0,r._)(this,"stagingBuffer",void 0),(0,r._)(this,"inputTensor",void 0),(0,r._)(this,"outputTensor",void 0),(0,r._)(this,"device",void 0),this.ortSession=null,this.inputBuffer=null,this.outputBuffer=null,this.stagingBuffer=null,this.inputTensor=null,this.outputTensor=null,this.device=null}}let g={type:"loading",progress:0};(async()=>{let t=t=>{g=t.value,v.broadcast(t)};try{let[e,i]=await h(e=>{t({id:null,type:"status",value:{type:"loading",progress:e}})});t({id:null,type:"status",value:{type:"initializing",progress:1}}),c=await new p().init(e,i),t({id:null,type:"status",value:{type:"ready",progress:1}})}catch(e){throw t({id:null,type:"status",value:{type:"error",progress:1}}),e}})();class d{postMessage(t,e){clearTimeout(this.expireTimeout),this.expireTimeout=self.setTimeout(()=>{this.port.close(),this.portManager.ports=this.portManager.ports.filter(t=>t!==this)},1e4),this.port.postMessage(t,e)}addEventListener(t,e){if("message"===t){let t=e;e=e=>{if("pong"!==e.data.type)t(e)}}this.port.addEventListener(t,e)}constructor(t,e){(0,r._)(this,"port",void 0),(0,r._)(this,"portManager",void 0),(0,r._)(this,"expireTimeout",void 0),this.port=t,this.portManager=e,this.expireTimeout=0,this.port.start()}}let v=new class t{addPort(t){let e=new d(t,this);return this.ports.push(e),t.addEventListener("message",t=>{"pong"===t.data.type&&clearTimeout(e.expireTimeout)}),e}broadcast(t,e){this.ports.forEach(i=>i.postMessage(t,e))}constructor(){(0,r._)(this,"ports",void 0),this.ports=[]}};self.addEventListener("connect",t=>{let{ports:e}=t,i=v.addPort(e[0]);v.broadcast({}),i.postMessage({id:null,type:"status",value:g}),i.addEventListener("message",async t=>{let e=t.data;if("inference"===e.action){let t="file"===e.type?await new Promise(t=>{let i=new FileReader;i.onload=function(e){t(new Blob([e.target.result],{type:"application/octet-stream"}))},i.readAsArrayBuffer(e.value)}):e.value,r=Date.now();l=l.then(()=>f(t));let s=await l;console.log("Inference time: ",Date.now()-r),i.postMessage({id:e.id,value:s},[s.buffer])}})}),self.onmessage=async function(t){}}},e={};function i(r){var s=e[r];if(void 0!==s)return s.exports;var a=e[r]={exports:{}};return t[r](a,a.exports,i),a.exports}i.m=t,i.x=()=>{var t=i.O(void 0,["809"],function(){return i("540")});return t=i.O(t)},i.d=function(t,e){for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},i.f={},i.e=function(t){return Promise.all(Object.keys(i.f).reduce(function(e,r){return i.f[r](t,e),e},[]))},i.u=function(t){return"assets/"+t+".aa50c46e.js"},i.miniCssF=function(t){return""+t+".css"},i.h=function(){return"eaa42335b4da6e82"},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},(()=>{var t=[];i.O=function(e,r,s,a){if(r){a=a||0;for(var n=t.length;n>0&&t[n-1][2]>a;n--)t[n]=t[n-1];t[n]=[r,s,a];return}for(var o=1/0,n=0;n<t.length;n++){for(var r=t[n][0],s=t[n][1],a=t[n][2],u=!0,h=0;h<r.length;h++)(!1&a||o>=a)&&Object.keys(i.O).every(function(t){return i.O[t](r[h])})?r.splice(h--,1):(u=!1,a<o&&(o=a));if(u){t.splice(n--,1);var c=s();void 0!==c&&(e=c)}}return e}})(),i.rv=function(){return"1.1.3"},(()=>{var t=i.x;i.x=function(){return i.e("809").then(t)}})(),(()=>{i.g.importScripts&&(t=i.g.location+"");var t,e=i.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");if(r.length){for(var s=r.length-1;s>-1&&(!t||!/^http(s?):/.test(t));)t=r[s--].src}}if(!t)throw Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t+"../"})(),(()=>{i.b=self.location+"/../../";var t={370:1};i.f.i=function(e,r){!t[e]&&importScripts(i.p+i.u(e))};var e=self.webpackChunkkaeru_web_image_classification=self.webpackChunkkaeru_web_image_classification||[],r=e.push.bind(e);e.push=function(e){var s=e[0],a=e[1],n=e[2];for(var o in a)i.o(a,o)&&(i.m[o]=a[o]);for(n&&n(i);s.length;)t[s.pop()]=1;r(e)}})(),i.ruid="bundler=rspack@1.1.3",i.x()})();