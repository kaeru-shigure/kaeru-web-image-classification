(()=>{"use strict";var e={535:function(e,t,a){var r=a("584"),l=a("400"),n=a("412"),i=a("433"),s=JSON.parse('{"m":"SmilingWolf/wd-swinv2-tagger-v3"}');let u=(0,i.td)({type:"loading",progress:0}),o=(0,i.td)(null),c=(0,i.td)([]),d=(0,i.td)({list:[],map:new Map}),g=(0,i.td)(),v=()=>{},p=new Promise(e=>{v=e}),m=(async()=>{let e=await fetch(`https://huggingface.co/${s.m}/raw/main/selected_tags.csv`).then(e=>e.text()).then(e=>e.trim().split("\n").slice(1).map(e=>e.split(",")).map((e,t)=>{let[,a,r]=e;return[a,{i:t,category:parseInt(r)}]})),t={list:e,map:new Map(e)};return d.value=t,t})(),h=new SharedWorker(new URL(a.p+a.u("370"),a.b),Object.assign({},{type:"module",credentials:"include"},{type:void 0}));h.port.start();let f=new Map,y=(e,t)=>{f.get(e)(t),f.delete(e)};h.port.addEventListener("message",e=>{let t=e.data;h.port.postMessage({type:"pong"}),"status"===t.type&&(u.value=t.value,"ready"===t.value.type&&v()),f.has(t.id)&&y(t.id,t.value)});let w=0;class b{getDetail(){return Array.from(this.raw).map((e,t)=>[["general",null,null,null,"character",null,null,null,null,"rating"][this._dict.list[t][1].category],this._dict.list[t][0],e]).sort((e,t)=>t[2]-e[2])}getSummary(){let e={general:[],character:[],rating:[]};for(let[t,a,r]of this.getDetail())e[t].push([a,r]);return e}get(e){return this.raw[this._dict.map.get(e).i]}constructor(e,t,a){(0,n._)(this,"file",void 0),(0,n._)(this,"raw",void 0),(0,n._)(this,"_dict",void 0),this.file=e,this.raw=t,this._dict=a}}let Z=new WeakMap,N=async e=>Z.has(e)?Z.get(e):new Promise(t=>{p=p.then(async()=>{let a=await m,r=w++;h.port.postMessage({id:r,action:"inference",type:"file",value:e});let l=new b(e,await new Promise(e=>{f.set(r,e)}),a);Z.set(e,l),t(l)})}),k=0,B=async(e,t)=>{let a=++k;g.value=null,c.value=[];let r=[];for(let t of e){o.value={total:e.length,completed:r.length};let l=await N(t);if(a!==k)return;r.push({file:t,result:l})}if(o.value=null,c.value=r,1===r.length){g.value=r[0].result,null==t||t(!0);return}null==t||t(!1)};var L=a("661");let T={dropzone:"dropzone-d8jhat",hover:"hover-zTT9cQ"},I=e=>{let{onFilesDropped:t,children:a}=e,[l,n]=(0,L.useState)(!1),i=e=>{e.preventDefault(),e.stopPropagation(),n(!0)},s=e=>{e.preventDefault(),e.stopPropagation(),n(!1)},u=async e=>{if(e.preventDefault(),e.stopPropagation(),n(!1),!e.dataTransfer)return;e.preventDefault();let a=e.dataTransfer.items,r=new Set(Array.from(e.dataTransfer.files).filter(e=>e.name.match(/\.(?:png|jpe?g|webp|bmp|gif)$/)));for(let e=0;e<a.length;e++){let t=a[e];if("file"===t.kind){let e=t.webkitGetAsEntry();e&&!e.isFile&&await o(e,r)}}t(Array.from(r))};async function o(e,t){if(e.isFile){let a=await new Promise(t=>{e.file(t)});a.name.match(/\.(?:png|jpe?g|webp|bmp|gif)$/)&&t.add(a)}else if(e.isDirectory){let a;let r=e.createReader();do for(let e of a=await new Promise(e=>{r.readEntries(t=>e(t))}))await o(e,t);while(a.length>0)}}async function c(e){var a;let r=null===(a=e.clipboardData)||void 0===a?void 0:a.items;if(!r)return;let l=new Set;for(let e=0;e<r.length;e++){let t=r[e];if("file"===t.kind){let e=t.getAsFile();(null==e?void 0:e.name.match(/\.(?:png|jpe?g|webp|bmp|gif)$/))&&l.add(e)}}t(Array.from(l))}return(0,L.useLayoutEffect)(()=>(document.addEventListener("dragover",i),document.addEventListener("dragleave",s),document.addEventListener("drop",u),document.addEventListener("paste",c),()=>{document.removeEventListener("dragover",i),document.removeEventListener("dragleave",s),document.removeEventListener("drop",u),document.removeEventListener("paste",c)}),[t]),(0,r.tZ)("div",{className:`${T.dropzone} ${l?T.hover:""}`,children:a})},S="content-exl9Xb",O="wrapper-zAorWF",E="loader-u36gEG",P=()=>(0,r.tZ)("div",{className:O,children:(0,r.tZ)("span",{className:E})}),_={error:()=>"An error occurred while loading the model.",ready:()=>"Ready. Drop an image to classify.",loading:e=>{let{progress:t}=e;return`Loading model...(${(100*t).toFixed(2)}%)`},initializing:()=>"Initializing model..."},j={error:{color:"#f90"},ready:{},loading:{color:"#999"},initializing:{color:"#999"}},X=e=>{let{workerStatus:t}=e;return(0,r.BX)("div",{className:S,children:["ready"!==t.type?(0,r.tZ)("div",{style:{marginBottom:"10px"},children:(0,r.tZ)(P,{})}):null,(0,r.tZ)("h1",{children:"Kaeru Image Classification"}),(0,r.tZ)("p",{style:j[t.type],children:_[t.type](t)}),(0,r.BX)("p",{children:["model: ",s.m]})]})},D="content-B2R1aV",A="progressBar-GAikDZ",R="progressBarValue-arz9nY",C=e=>{let{total:t,completed:a}=e;return(0,r.BX)("div",{className:D,children:[(0,r.tZ)(P,{}),(0,r.tZ)("h1",{children:"Inference in progress..."}),(0,r.BX)("p",{children:[a," / ",t]}),(0,r.tZ)("div",{className:A,children:(0,r.tZ)("div",{className:R,style:{transform:`scaleX(${a/t})`}})})]})};var V=a("387"),x=a.n(V),Y=a("396");let F=e=>{let{...t}=e,a=(0,i.qs)("");return(0,Y.d4)(()=>{let e=URL.createObjectURL(t.file);return a.value=e,()=>URL.revokeObjectURL(e)},[t.file]),(0,r.tZ)("img",{src:a.value,...t})},$="catalogList-tRcThS",z="catalogListItem-kjgAdK";var M=a("523");let W={wrapper:"wrapper-VbkfgA",placeholder:"placeholder-JvRGj2",suggest:"suggest-Pp4uvy"},U=(0,L.memo)(e=>{let{value:t,suggestValue:a,onInput:l,onFocus:n,onBlur:i,onClassInput:s}=e,[u,o]=(0,L.useState)(!1);return(0,r.BX)("div",{className:W.wrapper,children:[u||""!==t?null:(0,r.tZ)("div",{className:W.placeholder,children:"enter class name..."}),(0,r.BX)("div",{className:W.suggest,children:[(0,r.tZ)("span",{style:{visibility:"hidden"},children:t}),(null==a?void 0:a.slice(t.length))??""]}),(0,r.tZ)("input",{type:"text",value:t,onFocus:e=>{n(),o(!0),e.currentTarget.select()},onBlur:()=>{i(),o(!1)},onKeyDown:e=>{("Enter"===e.key||"Tab"===e.key)&&e.preventDefault(),"Enter"===e.key?s(t):"Tab"===e.key&&null!==a&&s(a)},onInput:l})]})}),K={wrapper:"wrapper-FAgJPv",listWrapper:"listWrapper-OW8hkN",filterValuesList:"filterValuesList-zbDia8",suggestList:"suggestList-D0r7TW",filterValuesListItem:"filterValuesListItem-q12FjI",suggestListItem:"suggestListItem-t0DYx_"},q=(0,i.td)([]),J=e=>{let{className:t,style:a}=e,[l,n]=(0,Y.eJ)(!1),i=(0,Y.I4)(()=>{n(!0)},[]),s=(0,Y.I4)(()=>{setTimeout(()=>{n(!1)},500)},[]),[u,o]=(0,Y.eJ)(""),c=(0,Y.Ye)(()=>u.replace(/ /g,"_"),[u]),g=(0,Y.Ye)(()=>{var e;return""===c?null:(null===(e=d.value.list.find(e=>e[0].startsWith(c)))||void 0===e?void 0:e[0])||null},[c]),v=(0,Y.I4)(e=>{o(e.currentTarget.value)},[]),p=(0,Y.I4)(e=>{d.value.map.has(e)&&(o(""),q.value=[...q.value,e])},[d.value]),m=(0,Y.Ye)(()=>""===c?[]:d.value.list.map(e=>{let[t]=e;return[t.indexOf(c),t]}).filter(e=>{let[t]=e;return -1!==t}).sort((e,t)=>{let[a,r]=e,[l,n]=t;return a-l}).map(e=>{let[,t]=e;return t}),[c,d.value]);return(0,r.BX)("div",{className:x()(t,K.wrapper),style:a,children:[(0,r.tZ)(U,{value:u,suggestValue:g,onInput:v,onClassInput:p,onFocus:i,onBlur:s}),(0,r.BX)("div",{className:K.listWrapper,children:[(0,r.tZ)("div",{className:K.filterValuesList,children:q.value.map(e=>(0,r.tZ)("div",{className:K.filterValuesListItem,onClick:()=>{q.value=q.value.filter(t=>t!==e)},children:e},e))}),l&&0!==m.length?(0,r.tZ)("div",{className:K.suggestList,children:m.map(e=>(0,r.tZ)("div",{className:K.suggestListItem,onClick:()=>{p(e)},children:e},e))}):null]})]})},G=e=>1===e?1:1-Math.pow(2,-10*e),H=e=>{let{className:t,style:a}=e,l=(0,Y.sO)(null),n=(0,M.s0)(),i=(0,Y.I4)(e=>{let{result:t}=e;return q.value.map(e=>{let{category:a}=d.value.map.get(e);return G(t.get(e))}).reduce((e,t)=>e+t,0)},[d.value,q.value]),s=(0,Y.Ye)(()=>[...c.value].sort((e,t)=>i(t)-i(e)),[c.value,i]);return(0,Y.d4)(()=>{var e;null===(e=l.current)||void 0===e||e.scrollTo(0,0)},[s]),(0,Y.d4)(()=>{let e=e=>{if(null!==g.value&&("ArrowLeft"===e.key||"ArrowRight"===e.key)){let t=s.findIndex(e=>e.result===g.value);if(-1===t)return;let a=(t+("ArrowLeft"===e.key?-1:1)+s.length)%s.length;g.value=s[a].result}};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[s]),(0,r.tZ)("div",{className:x()(t,$),style:a,ref:l,children:s.map(e=>{let{file:t,result:a}=e;return(0,r.tZ)(F,{className:z,file:t,onClick:()=>{g.value=a,n("/view")}})})})},Q="wrapper-RseQc3",ee="filterConfigPanel-VB0VG3",et="catalogPanel-ZYI5KP",ea=()=>(0,r.BX)("div",{className:Q,children:[(0,r.tZ)(J,{className:ee}),(0,r.tZ)(H,{className:et})]}),er={wrapper:"wrapper-YSQp9e",contentBody:"contentBody-Czf1e5",title:"title-cp7qTC",backButton:"backButton-haNSEp",image:"image-bg_V4I",summary:"summary-awt2OK",ratingTags:"ratingTags-KXJuPy",generalTags:"generalTags-mdHnKs",characterTags:"characterTags-ZL9hPB"},el={tagItem:"tagItem-YhmRix",filterTarget:"filterTarget-PD0WM6",actionButton:"actionButton-DDaOq3",delete:"delete-jA8i1e",tag:"tag-o6yCLb",tagValue:"tagValue-BUeg6U",tagName:"tagName-k8YLFs"},en=e=>{let{tag:t,value:a}=e,l=(0,Y.sO)(null),n=q.value.includes(t),i=c.value.length>1;return(0,r.BX)("div",{className:x()(el.tagItem,{[el.filterTarget]:i&&n}),children:[(0,r.BX)("div",{className:el.tag,style:{"--value":a},onClick:()=>{var e,t;if(!l.current)return;let a=document.createRange();a.selectNode(l.current),null===(e=window.getSelection())||void 0===e||e.removeAllRanges(),null===(t=window.getSelection())||void 0===t||t.addRange(a)},children:[(0,r.tZ)("div",{className:el.tagValue,children:a.toFixed(5)}),(0,r.tZ)("div",{className:el.tagName,ref:l,children:t})]}),i?(0,r.tZ)("button",{className:x()(el.actionButton,{[el.delete]:n}),onClick:()=>{n?q.value=q.value.filter(e=>e!==t):q.value=[...q.value,t]}}):null]})},ei={general:1,sensitive:2,questionable:3,explicit:4},es=e=>{let{isSingle:t,result:a}=e,l=(0,Y.Ye)(()=>a.getSummary(),[a]),n=c.value.length>1;return(0,r.BX)("div",{className:er.wrapper,children:[(0,r.BX)("div",{className:er.contentBody,children:[(0,r.BX)("div",{className:er.title,children:[n?(0,r.tZ)("button",{className:er.backButton,onClick:()=>{g.value=null}}):null,(0,r.tZ)("h1",{children:a.file.name})]}),(0,r.tZ)(F,{className:er.image,file:a.file})]}),(0,r.BX)("div",{className:er.summary,children:[(0,r.tZ)("div",{className:er.ratingTags,children:[...l.rating].sort((e,t)=>{let[a]=e,[r]=t;return ei[a]-ei[r]}).map(e=>{let[t,a]=e;return(0,r.tZ)(en,{tag:t,value:a},t)})}),(0,r.tZ)("div",{className:er.generalTags,children:l.general.slice(0,150).map(e=>{let[t,a]=e;return(0,r.tZ)(en,{tag:t,value:a},t)})}),(0,r.tZ)("div",{className:er.characterTags,children:l.character.slice(0,75).map(e=>{let[t,a]=e;return(0,r.tZ)(en,{tag:t,value:a},t)})})]})]})};var eu=a("593");let eo=()=>{let e=(0,M.s0)(),t=(0,M.bS)("/view"),a=async t=>{if(0===t.length)return;let a=location.hash.match(/view/);B(t,t=>{t&&!a?e("/view"):!t&&a&&e("/")})};return(0,r.BX)(r.HY,{children:[(0,r.tZ)(eu.q,{children:(0,r.tZ)("title",{children:null===o.value?"kaeru-ic":`${o.value.completed} / ${o.value.total}`})}),null===o.value?0===c.value.length?(0,r.tZ)(X,{workerStatus:u.value}):(0,r.BX)(r.HY,{children:[(0,r.tZ)(ea,{}),g.value&&(1===c.value.length||t)?(0,r.tZ)(es,{isSingle:1===c.value.length,result:g.value}):null]}):(0,r.tZ)(C,{total:o.value.total,completed:o.value.completed}),(0,r.tZ)(I,{onFilesDropped:a})]})},ec=document.getElementById("app");ec&&(0,l.sY)((0,r.tZ)(()=>(0,r.tZ)(M.UT,{children:(0,r.tZ)(eo,{})}),{}),ec)}},t={};function a(r){var l=t[r];if(void 0!==l)return l.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,a),n.exports}a.m=e,a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},a.d=function(e,t){for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.u=function(e){return"assets/"+e+".b4eb99d8.js"},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];a.O=function(t,r,l,n){if(r){n=n||0;for(var i=e.length;i>0&&e[i-1][2]>n;i--)e[i]=e[i-1];e[i]=[r,l,n];return}for(var s=1/0,i=0;i<e.length;i++){for(var r=e[i][0],l=e[i][1],n=e[i][2],u=!0,o=0;o<r.length;o++)(!1&n||s>=n)&&Object.keys(a.O).every(function(e){return a.O[e](r[o])})?r.splice(o--,1):(u=!1,n<s&&(s=n));if(u){e.splice(i--,1);var c=l();void 0!==c&&(t=c)}}return t}})(),a.rv=function(){return"1.1.3"},(()=>{a.g.importScripts&&(e=a.g.location+"");var e,t=a.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length){for(var l=r.length-1;l>-1&&(!e||!/^http(s?):/.test(e));)e=r[l--].src}}if(!e)throw Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e+"../"})(),(()=>{a.b=document.baseURI||self.location.href;var e={980:0};a.O.j=function(t){return 0===e[t]};var t=function(t,r){var l=r[0],n=r[1],i=r[2],s,u,o=0;if(l.some(function(t){return 0!==e[t]})){for(s in n)a.o(n,s)&&(a.m[s]=n[s]);if(i)var c=i(a)}for(t&&t(r);o<l.length;o++)u=l[o],a.o(e,u)&&e[u]&&e[u][0](),e[u]=0;return a.O(c)},r=self.webpackChunkkaeru_web_image_classification=self.webpackChunkkaeru_web_image_classification||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),a.ruid="bundler=rspack@1.1.3";var r=a.O(void 0,["719"],function(){return a("535")});r=a.O(r)})();